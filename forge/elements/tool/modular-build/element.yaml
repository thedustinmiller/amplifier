metadata:
  name: modular-build
  type: tool
  version: 1.0.0
  description: modular-build command
  author: amplifier
  tags:
  - workflow
  - command
  license: MIT
dependencies:
  principles:
  - respect-user-time
  constitutions: []
  tools: []
  agents: []
  templates: []
  suggests: []
conflicts:
  principles: []
  tools: []
  agents: []
  reason: null
interface:
  inputs:
    arguments: Command arguments
  outputs:
    result: Command result
  role: null
  events: []
implementation:
  instructions: "# /modular-build\n\n## Purpose: For AI/Agent Use\n\nThis is a **tool**\
    \ element designed for AI/agent invocation during autonomous reasoning and execution.\
    \ It is not intended for direct user invocation.\n\n**Key distinction:**\n- **Tools**\
    \ (this element): Invoked by AI agents internally during their reasoning process\n\
    - **Commands**: User-facing slash commands or CLI commands for direct invocation\n\
    \nIf you're a user looking to interact with this functionality, there may be a\
    \ corresponding command element available. Tools are building blocks that agents\
    \ use to accomplish tasks.\n\n---\n\n**Purpose:** One command to go from a natural\u2011\
    language **ask** \u2192 **Contract & Spec** \u2192 **Plan** \u2192 **Generate**\
    \ \u2192 **Review**.\nIt does not call other commands; it drives sub\u2011agents\
    \ and micro\u2011tools directly. It force\u2011loads the authoring guide.\n\n\
    **Context include (MANDATORY):**\n@ai_context/module_generator/CONTRACT_SPEC_AUTHORING_GUIDE.md\n\
    \n**Usage (NL ask via ARGUMENTS):**\n\n```\n/modular-build Build a module that\
    \ reads markdown summaries, synthesizes net-new ideas with provenance, and expands\
    \ them into plans. mode: auto level: moderate\n```\n\n- Optional inline hints:\
    \ `mode: auto|assist|dry-run`, `version: x.y.z`, `level: minimal|moderate|high`,\
    \ `depends: modA:pathA,modB:pathB`\n\n**Modes**\n\n- **auto** (default): run autonomously\
    \ if confidence \u2265 0.75; otherwise switch to **assist**.\n- **assist**: ask\
    \ \u2264 5 crisp questions, then proceed.\n- **dry-run**: produce/validate artifacts\
    \ up to the next gate without writing code (planning only).\n\n---\n\n## ARGUMENTS\n\
    \n(if missing or not clear from the conversation context, or not continuing a\
    \ prior session, ask the user for whatever is needed to be clear you know how\
    \ to assist them best)\n\n<ARGUMENTS>\n$ARGUMENTS\n</ARGUMENTS>\n\n## ULTRATHINK\
    \ SETUP (IMPORTANT)\n\nUse deep reasoning. When uncertain, propose 2\u20133 options\
    \ with tradeoffs, then pick one. Keep steps bounded and observable.\nApply the\
    \ isolation model from the guide: worker reads only this module\u2019s contract/spec\
    \ + dependency **contracts**. Output Files are SSOT.\nUse strict JSON when asked\
    \ (no markdown fences).\n\n## Phase A \u2014 Intent (derive/continue module metadata\
    \ from the ask)\n\n1. As **module-intent-architect**, derive/update metadata from\
    \ `ARGUMENTS` + chat context and persist/merge `ai_working/<name>/session.json`:\n\
    \   - `module_name`, `MODULE_ID`, `version` (default `0.1.0`), `level` (default\
    \ `moderate`), `depends[]` (dependency **contracts**).\n   - Compute a confidence\
    \ score; if < 0.75 or mode=assist, ask \u2264 5 targeted questions; then proceed.\n\
    \   - If a prior session exists, append the ask to `ask_history` and continue\
    \ the flow from the appropriate phase.\n\n## Phase B \u2014 Bootstrap (create\
    \ Contract & Spec if missing)\n\n1. If `ai_working/<name>/<MODULE_ID>.contract.md`\
    \ or `...impl_spec.md` is missing:\n   - As **contract-spec-author**, write both\
    \ files per the Authoring Guide and the captured intent.\n   - Contract front\u2011\
    matter: `module`, `artifact: contract`, `version`, `depends_on` (declared dependency\
    \ **contracts** only).\n   - Spec front\u2011matter: `artifact: spec`, `contract_ref`,\
    \ `targets`, `level`.\n   - Spec **Output Files** must list every file the generator\
    \ will write (SSOT).\n2. Normalize for tooling:\n   ```\n   Bash(.claude/tools/spec_to_json.py\
    \          --contract \"ai_working/<name>/<MODULE_ID>.contract.md\"          --spec\
    \     \"ai_working/<name>/<MODULE_ID>.impl_spec.md\"          --out      \"ai_working/<name>/spec_norm.json\"\
    )\n   ```\n3. `TodoWrite(\"Bootstrapped <name> artifacts\", status=completed,\
    \ metadata={spec_norm:\"ai_working/<name>/spec_norm.json\"})`\n\n## Phase C \u2014\
    \ Plan (STRICT JSON; no code writes)\n\n1. As **zen-architect**, synthesize `plan.json`\
    \ using only the module\u2019s contract/spec and dependency **contracts**.\n \
    \  - `file_tree` must **exactly** equal the spec\u2019s **Output Files**.\n  \
    \ - Include `conformance_mapping`: each contract **Conformance Criterion** \u2192\
    \ \u22651 test path.\n   - Save:\n     - `Write(ai_working/<name>/plan.json, <strict\
    \ JSON>)`\n     - `Write(ai_working/<name>/plan.md, <human summary>)`\n2. Validate\
    \ & (optional) self\u2011revise (\u2264 2 attempts):\n   ```\n   Bash(.claude/tools/plan_guard.py\
    \ --plan \"ai_working/<name>/plan.json\" --spec-norm \"ai_working/<name>/spec_norm.json\"\
    \ --root \".\" --name \"<name>\")\n   Bash(.claude/tools/philosophy_check.py --spec-norm\
    \ \"ai_working/<name>/spec_norm.json\" --plan \"ai_working/<name>/plan.json\"\
    \ --root \".\")\n   ```\n   If still failing, summarize blockers and stop.\n3.\
    \ In **dry-run** mode, stop here after validation.\n\n## Phase D \u2014 Generate\
    \ (write only planned files)\n\n1. Confirm `plan.file_tree == spec_norm.spec.output_files`;\
    \ if not, stop and request fix.\n2. As **modular-builder**, create exactly the\
    \ files in `file_tree` under `amplifier/<name>/\u2026` (and tests per repo policy).\n\
    \   - Use **test-coverage** to realize `conformance_mapping` with fast, deterministic\
    \ tests.\n3. Run repo checks (existing scripts/targets).\n4. Validate & (optional)\
    \ self\u2011revise (\u2264 2 attempts):\n   ```\n   Bash(.claude/tools/drift_check.py\
    \ --name \"<name>\" --plan \"ai_working/<name>/plan.json\" --root \".\")\n   Bash(.claude/tools/plan_guard.py\
    \ --plan \"ai_working/<name>/plan.json\" --spec-norm \"ai_working/<name>/spec_norm.json\"\
    \ --root \".\" --name \"<name>\")\n   ```\n   If still failing, summarize diagnostics\
    \ in `ai_working/<name>/review.md` and stop.\n5. Write `ai_working/<name>/build_summary.md`\
    \ and mark TODO complete.\n\n## Phase E \u2014 Review / Harden\n\n1. Run tests:\n\
    \   ```\n   Bash(pytest -q)\n   ```\n2. As **test-coverage**, ensure each conformance\
    \ criterion has \u2265 1 **passing** test; add minimal tests if needed.\n3. As\
    \ **security-guardian**, do a quick security/readiness pass (IO, subprocess, error\
    \ mapping vs contract).\n4. Write `ai_working/<name>/review.md` with conformance\
    \ table and notes. Complete TODOs.\n"
  allowed_tools:
  - Bash
  - Read
  - Write
  - Edit
settings: {}
